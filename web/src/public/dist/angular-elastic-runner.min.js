!function(){"use strict";function e(e,r,t){function a(e,r,a){var u={index:e,type:r,body:a},o={newDoc:u},n={params:o},c=t.get("/createdoc",n);return c}function u(e,r,a){var u={index:e,type:r,id:a},o={delDoc:u},n={params:o},c=t.get("/deletedoc",n);return c}return{createDoc:a,deleteDoc:u}}angular.module("app").factory("esModifySvc",["$location","$state","$http",e])}(),function(){"use strict";function e(e,r){var t=function(e){var r={query:{filtered:{query:{match_all:{}},filter:e}}};return r};return{buildFilteredQueryFromFilter:t}}angular.module("app").factory("queryDslSvc",["$location","$state",e])}(),function(){"use strict";function e(e,r,t){function a(e,r,a){var u={index:e,type:r,body:{query:{match:{_all:a}}}},o={searchQuery:u},n={params:o},c=t.get("/searchdoc_source",n);return c}function u(e,r){var a={index:e,type:r,body:{query:{match_all:{}},sort:{_id:"desc"}}},u={searchQuery:a},o={params:u},n=t.get("/searchdoc",o);return n}function o(e,r,a){var u={index:e,type:r,body:a},o={searchQuery:u},n={params:o},c=t.get("/searchdoc_source",n);return c}function n(e,r,a){var u={index:e,type:r,body:{aggs:{max_id:{max:{field:a}}},size:0}},o={searchQuery:u},n={params:o},c=t.get("/searchdoc",n);return c}function c(e,r,a,u){var o={index:e,type:r,body:{query:{bool:{must:[{match:{}}]}}}};o.body.query.bool.must[0].match[a]=u;var n={searchQuery:o},c={params:n},s=t.get("/searchdoc",c);return s}return{queryMatchAllTerms:a,queryMatchAllDesc:u,anyQuery:o,fieldMaxValue:n,termQueryByKV:c}}angular.module("app").factory("esSearchSvc",["$location","$state","$http",e])}(),function(){"use strict";function e(e,r,t,a,u,o){var n=this;n.isWrapperToggled=!0,n.elasticBuilderData={},n.elasticBuilderData.fields={ingredients:{type:"term"},description:{type:"term"},name:{type:"term"},recipeYield:{type:"term"},datePublished:{type:"date"},source:{type:"multi",choices:["bbcfood","aspicyperspective","bonappetit","chow","101cookbooks","delishhh","naturallyella","thevintagemixer","thepioneerwoman"]}};var c=[{terms:{source:["bbcfood","bonappetit"]}},{range:{datePublished:{lte:"2013-02-01",format:"yyyy-MM-dd"}}},{term:{name:"chickpea"}}];0===u.data.hits.hits.length?n.elasticBuilderData.query=c:n.elasticBuilderData.query=u.data.hits.hits[0]._source.queryObject.queryFilter,n.elasticBuilderData.needsUpdate=!0;var s=function(e){var r=JSON.stringify(e,null,2);return r};n.showFilteredQuery=function(){n.filteredQuery=o.buildFilteredQueryFromFilter(n.elasticBuilderData.query),n.esQueryStringified=s(n.filteredQuery)};var i=function(r){t.anyQuery("openrecipes","recipe",r).then(function(r){var t=[];t=r.data,n.resultsArr=t,e.go("querybuilder.run-query")}).catch(function(r){n.errorMessage="querybuilder.run-failed",e.go("querybuilder.run-failed")})};n.runFilteredQuery=function(){i(o.buildFilteredQueryFromFilter(n.elasticBuilderData.query))};var l=function(e){return t.fieldMaxValue("openrecipes","query",e)};n.saveQuery=function(){l("queryObject.queryId").then(function(e){var r=e.data.aggregations.max_id.value+1,t={queryObject:{queryId:r,query:n.filteredQuery,queryFilter:n.elasticBuilderData.query,label:n.queryLabel}};a.createDoc("openrecipes","query",s(t)).then(function(e){console.log("Query saved succcessfully to ES!")}).catch(function(e){console.log("Failed to save query to ES!"),n.errorMessage=e.message,console.trace(e.message)})}).catch(function(e){console.log("Failed to retrieve max queryObject.id from ES !"),console.trace(e.message)})},n.isQLToggled=!1}angular.module("app").controller("queryBuilderCtrl",["$state","$stateParams","esSearchSvc","esModifySvc","builderQuery","queryDslSvc",e])}(),function(){"use strict";function e(e,r,t,a){var u=this;u.queryTerm="",u.docs=[];var o=function(){var t=r.$parent.vm.queryTerm;a.queryMatchAllTerms("openrecipes","recipe",t).then(function(r){r.data[0].length>0&&(u.docs=r.data,e.go("search.succeeded"))}).catch(function(r,t,a,u){e.go("search.failed")})};r.$on("PleaseQueryES",function(){o()})}angular.module("app").controller("esSearchCtrl",["$state","$scope","$http","esSearchSvc",e])}(),function(){"use strict";function e(e,r,t,a,u,o,n){var c=this,s=[],i=function(){s.length=0;for(var e=n.data.hits.hits,r=0;r<e.length;r++)s.push(e[r]);return s};r.vmShared=r.vmShared||{resultQueries:i()},c.isQueryDisplayed=!0,c.showQuery=function(){e.go("listqueries.show-query")},c.queryResultsArr=[],c.runQuery=function(r){u.anyQuery("openrecipes","recipe",r.query).then(function(t){var a=[];a=t.data;var u={answerSet:a,queryLabel:r.label},o=c.queryResultsArr.map(function(e){return e.queryLabel}).indexOf(u.queryLabel);o===-1?c.queryResultsArr.push(u):c.queryResultsArr[o]=u,e.go("listqueries.run-query")}).catch(function(r,t,a,u){c.errorMessage="listqueries.failed",e.go("listqueries.failed")})},c.goToBuilder=function(r){e.go("querybuilder",{queryObject:r})},c.deleteQuery=function(e){o.deleteDoc("openrecipes","query",e._id).then(function(t){r.vmShared.resultQueries.splice(r.vmShared.resultQueries.indexOf(e),1),console.log("Query deleted succcessfully !")}).catch(function(e){console.log("Failed to delete query !"),c.errorMessage=e.message,console.trace(e.message)})}}angular.module("app").controller("listQueriesCtrl",["$state","$scope","$http","$window","esSearchSvc","esModifySvc","listQueries",e])}(),function(){"use strict";function e(e,r,t,a,u,o){}angular.module("app").controller("showQueryCtrl",["$state","$scope","$window","esSearchSvc","esModifySvc","listQueries",e])}(),function(){"use strict";function e(e){function r(e,r,t,a,u){console.log("state change start",e,"toState:",r,"toParams:",t,"fromState:",a,"fromParams:",u)}function t(e,r,t,a,u){console.log("state change success",e,"toState:",r,"toParams:",t,"fromState:",a,"fromParams:",u)}function a(e,r,t,a,u,o){console.log("state change error",e,r,t,a,u,o)}function u(e,r,t,a){console.log("state not found",e,r,t,a)}e.$on("$stateChangeStart",r),e.$on("$stateChangeSuccess",t),e.$on("$stateChangeError",a),e.$on("$stateNotFound",u);var o={};return o}angular.module("app").factory("stateWatcherService",e),e.$inject=["$rootScope"]}();